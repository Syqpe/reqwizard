FROM golang:1.20.1

ARG GO_ENV
ENV GO_ENV ${GO_ENV}

ARG DB_URI
ENV DB_URI ${DB_URI}
ARG DB_NAME
ENV DB_NAME ${DB_NAME}
ARG DB_USER
ENV DB_USER ${DB_USER}
ARG DB_USER_PASSWORD
ENV DB_USER_PASSWORD ${DB_USER_PASSWORD}

ARG AUTH_SIGNING_KEY
ENV AUTH_SIGNING_KEY ${AUTH_SIGNING_KEY}
ARG AUTH_TOKEN_TTL
ENV AUTH_TOKEN_TTL ${AUTH_TOKEN_TTL}

ARG SMTP_PASSWORD
ENV SMTP_PASSWORD ${SMTP_PASSWORD}

WORKDIR /app

COPY go.mod ./
COPY go.sum ./

RUN go mod vendor

# копируем код
COPY . .
RUN make build

EXPOSE 8080

CMD [ "./.bin/app" ]